server {
        listen 80;
#       listen 443 ssl;
        server_name webserver;
      	server_name_in_redirect off;
      	port_in_redirect off;

 #       ssl_certificate /etc/letsencrypt/live/mattp.it/fullchain.pem;
 #       ssl_certificate_key /etc/letsencrypt/live/mattp.it/privkey.pem;

    	# Log XFF IP instead of varnish
    	#set_real_ip_from    10.0.0.0/8;
    	#set_real_ip_from    127.0.0.1;
    	real_ip_header      X-Forwarded-For;
    	real_ip_recursive   on;

        root /var/www/html;
	index index.php index.html index.htm;
	client_max_body_size 2048M;

    	# brotli on;
   	  # brotli_static on;
    	# brotli_comp_level 4;
    	# brotli_types text/plain text/css text/javascript application/javascript text/xml application/xml image/svg+xml application/json;

    	# deny dot-files
    	location ~ /\. {
        	deny all;
        	access_log off;
        	log_not_found off;
    	}

#    	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
#    	add_header X-Frame-Options SAMEORIGIN;
#    	add_header X-Content-Type-Options nosniff;
#    	add_header X-XSS-Protection "1; mode=block";

      	location ~ ^([^.\?]*[^/])$ {
        	try_files $uri @addslash;
      	}
      	location @addslash {
          rewrite ^ http://webserver$request_uri/? permanent;
      	}

    	location / {
        	try_files $uri $uri/ =404;
    	}

    	location ~ [^/]\.php(/|$) {
        	fastcgi_split_path_info ^(.+?\.php)(|/.*)$;
        	if (!-f $document_root$fastcgi_script_name) {
            		return 404;
        	}
        	include fastcgi_params;
        	fastcgi_index index.php;
        	fastcgi_read_timeout 6000;
        	fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        	fastcgi_param PATH_INFO $fastcgi_path_info;
        	fastcgi_pass unix:/var/run/php/php8.0-fpm.sock;
    	}
}
